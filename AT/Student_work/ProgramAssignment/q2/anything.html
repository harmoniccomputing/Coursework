<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Minimal Lindenmayer usage</title>
</head>

<body>

  <h1>Anything that can happen will happen (4 iterations)</h1>

  <canvas id="canvas1" width="400" height="400"></canvas>

  <label for="textresult">String result for the image:</label>
  <textarea id="textresult" rows="12"></textarea>

  <script src="lindenmayer.js"></script>
  <script type="text/javascript">
    var iterations = 4;
    var result = '';

    function draw_LSystem(canvasId) {
      var canvas = document.getElementById(canvasId);
      var ctx = canvas.getContext("2d");

      // Translate so that the tree is in the center and rotate
      ctx.translate(canvas.width / 2, canvas.height / 1.5);
      ctx.rotate(Math.PI);

      var tree = new LSystem({
        axiom: 'X',
        productions: {
          'X': () => {
            let options = [
              'F-[[-X]+X]+F[+FX]-X',
              'F+[[+X]-X]-F[-FX]+X[X]'
            ];
            return options[Math.floor(Math.random() * options.length)];
          },
          'F': () => {
            let options = [
              'F[F]F',
              'F[+]F',
              'F[FF]F'
            ];
            return options[Math.floor(Math.random() * options.length)];
          }
        },
        finals: {
          'F': () => {
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(0, 25 / (tree.iterations + 1));
            ctx.stroke();
            ctx.translate(0, 25 / (tree.iterations + 1));
          },
          'G': () => {
            ctx.translate(0, 25 / (tree.iterations + 1));
          },
          '+': () => { ctx.rotate((Math.PI / 180) * 12.5); },
          '-': () => { ctx.rotate((Math.PI / 180) * -12.5); },
          '[': () => { ctx.save(); },
          ']': () => { ctx.restore(); }
        }
      });

      tree.iterate(iterations);
      result = tree.getString();
      tree.final();
    }

    // Draw on the single canvas
    draw_LSystem('canvas1')
    var textresult = document.getElementById('textresult');
    textresult.value = `Image result: ${result}`;

  </script>
</body>

</html>